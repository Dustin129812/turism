<form [formGroup]="newEvent" class="form" (ngSubmit)="onSubmit()">

  <ion-card>
    <ion-item>
  <ion-label position="floating">Locación</ion-label>
  <ion-select formControlName="location" interface="popover">
    @for (loc of locations; track loc.id) {
      <ion-select-option [value]="loc.id">
        {{ loc.name }}
      </ion-select-option>
    }
  </ion-select>
</ion-item>

@if(location.invalid && (location.dirty || location.touched)){

  @if(location.hasError('required')){
    <ion-text color="danger">
      <small>La locación es obligatoria</small>
    </ion-text>
  }

}

    <ion-item>
      <ion-label position="floating">Descripción</ion-label>
      <ion-textarea formControlName="description"></ion-textarea>
    </ion-item>
    @if(description.invalid && (description.dirty || description.touched)){
      @if(description.hasError('required')){
        <ion-text color="danger">
          <small>La descripción es obligatoria</small>
        </ion-text>
      }
    }

    <ion-item>
      <ion-label position="floating">Fecha del evento</ion-label>
      <ion-datetime formControlName="date" presentation="date"></ion-datetime>
    </ion-item>
    @if(date.invalid && (date.dirty || date.touched)){
      @if(date.hasError('required')){
        <ion-text color="danger">
          <small>La fecha es obligatoria</small>
        </ion-text>
      }
    }

    <ion-item>
      <ion-label position="floating">Hora de inicio</ion-label>
      <ion-datetime formControlName="startHour" presentation="time"></ion-datetime>
    </ion-item>
    @if(startHour.invalid && (startHour.dirty || startHour.touched)){
      @if(startHour.hasError('required')){
        <ion-text color="danger">
          <small>La hora de inicio es obligatoria</small>
        </ion-text>
      }
    }

    <ion-item>
      <ion-label position="floating">Hora de finalización</ion-label>
      <ion-datetime formControlName="endHour" presentation="time"></ion-datetime>
    </ion-item>
    @if(endHour.invalid && (endHour.dirty || endHour.touched)){
      @if(endHour.hasError('required')){
        <ion-text color="danger">
          <small>La hora de finalización es obligatoria</small>
        </ion-text>
      }
    }

    <ion-button expand="block" type="submit" [disabled]="newEvent.invalid">
      + Agregar evento
    </ion-button>

  </ion-card>
</form>
<ion-content class="ion-padding">
<ion-card>
<ion-card-header>
  <ion-card-title>Imágenes</ion-card-title>
  <ion-card-subtitle>Cámara & Galería</ion-card-subtitle>
</ion-card-header>
<ion-card-content>
  <ion-button expand="block" (click)="onTakePhoto()" [disabled]="loadingPhoto">
    <ion-icon name="camera" slot="start"></ion-icon>
    Tomar foto
  </ion-button>

  @if (photos.length) {
    <ion-grid class="ion-margin-top">
      <ion-row>
        @for (p of photos; track p.fileName) {
          <ion-col size="12" sizeMd="3">
            <ion-card class="photo-card">
              <img [src]="p.webviewPath" alt="img not found"/>
              <ion-item lines="none">
                <ion-label>{{ p.fileName }}</ion-label>
              </ion-item>
              <ion-item>
                <ion-button color="danger" fill="solid" (click)="deletePhoto(p)">
                  <ion-icon slot="icon-only" name="trash"></ion-icon>
                </ion-button>
              </ion-item>
            </ion-card>
          </ion-col>
        }
      </ion-row>
    </ion-grid>
  }
  @if (!photos.length) {
    <ion-text color="medium">
      <p>No hay fotos guardadas todavía.</p>
    </ion-text>
  }
</ion-card-content>
</ion-card>
